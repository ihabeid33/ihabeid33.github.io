---
layout: post
title: Active Directory Part 1 - Lab Setup
date: 2024-06-26 00:03:10.000000000 -04:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Active Directory
tags: []
image: assets/2024/06/ad_icon.webp
meta:
  _last_editor_used_jetpack: block-editor
  _edit_last: '1'
  bloglo_disable_topbar: ''
  bloglo_disable_header: ''
  bloglo_disable_page_title: ''
  bloglo_disable_breadcrumbs: ''
  bloglo_disable_thumbnail: ''
  bloglo_disable_footer: ''
  bloglo_disable_copyright: ''
  bloglo_disable_blog_card_border: ''
  _thumbnail_id: '240'
permalink: "/2024/06/26/active-directory-lab-part-1/"
---
<p></p>
<h2 class="wp-block-heading">Why Active Directory?</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Active Directory (AD) is a critical component in many IT environments, especially within organizations using Microsoft technologies. It is estimated that well over 90% of Fortune 1000 companies implement Active Directory services in some form. That is why it is crucial for anyone that wants to enter the IT field, must set up their own AD Lab to practice on. Here are some of the features provided by AD:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<!-- wp:list-item --></p>
<li>Active Directory allows administrators to centrally manage user accounts, computers, and groups using a single centralized database. Tasks such as user creation, password changes, and permission management can be done from a single machine and applied to the whole domain.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>A feature called Group Policy implements domain wide configurations such as security settings and software installations across all computers.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Another major part of Active Directory is Directory Services. This is basically like a repository (or database) that maps out all of the network resources on the domain, making them easily accessible. Such resources include printers, computers, and file shares.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>AD can also perform Single Sign-On (SSO) and access control. SSO is a way for users to log in one time and still access more than one resource on the network with specific permissions. Active Directory does this using one of two protocols:  Kerberos or LDAP.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Other features include Federation Services (ADFS), Auditing &amp; Monitoring, and redundancy/fault tolerance.</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>The next parts of this post are a walk-through on how I set up Active Directory in my Homelab environment.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2 class="wp-block-heading">Creating Server and Client VMs in Proxmox</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Every Active Directory environment will need at least a version of Windows Server for the Domain Controller, and one or more machines running Windows 7/8/10/11 for our workstations. I chose to run Windows Server 2019 and Windows 10 as virtual machines inside of a virtualization environment called Proxmox.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Links to the ISOs:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<!-- wp:list-item --></p>
<li><a href="https://info.microsoft.com/ww-landing-windows-server-2019.html">Windows Server 2019</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li><a href="https://www.microsoft.com/en-us/software-download/windows10ISO" data-type="link" data-id="https://www.microsoft.com/en-us/software-download/windows10ISO">Windows 10</a></li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Please note:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<!-- wp:list-item --></p>
<li>Windows 10 has four different editions: Home, Pro, Education, and Enterprise. </li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Windows 10 Home edition CANNOT be used to join a domain. </li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>In order to use Windows 10 in an AD environment, you must choose any one of the other three editions. </li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Windows 7 and 8 are the same way.</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Proxmox VE (Virtual Environment) is a Linux-based and open-source virtualization management solution. It is also a "Type 1" hypervisor, meaning it is run directly on a machine's physical hardware as the machine's operating system. "Type 2" hypervisors, such as Virtualbox and VMware Workstation, run as an application on top of an already existing OS.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>After downloading my ISO's, I went ahead and created two VMs on Proxmox. The screenshots below show the hardware specifications I used for each VM.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:jetpack/slideshow {"align":"","ids":[174,175],"sizeSlug":"large"} --></p>
<div class="wp-block-jetpack-slideshow" data-effect="slide">
<div class="wp-block-jetpack-slideshow_container swiper-container">
<ul class="wp-block-jetpack-slideshow_swiper-wrapper swiper-wrapper">
<li class="wp-block-jetpack-slideshow_slide swiper-slide">
<figure><img alt="" class="wp-block-jetpack-slideshow_image wp-image-174" data-id="174" src="{{site.baseurl}}/assets/2024/06/0_proxmox_winserver.png"><br />
<figcaption class="wp-block-jetpack-slideshow_caption gallery-caption">Server VM Specifications</figcaption>
</figure>
</li>
<li class="wp-block-jetpack-slideshow_slide swiper-slide">
<figure><img alt="" class="wp-block-jetpack-slideshow_image wp-image-175" data-id="175" src="{{site.baseurl}}/assets/2024/06/0_proxmox_win10-1024x380.png"><br />
<figcaption class="wp-block-jetpack-slideshow_caption gallery-caption">Windows 10 VM Specs</figcaption>
</figure>
</li>
</ul>
<p><a class="wp-block-jetpack-slideshow_button-prev swiper-button-prev swiper-button-white" role="button"></a><a class="wp-block-jetpack-slideshow_button-next swiper-button-next swiper-button-white" role="button"></a><a aria-label="Pause Slideshow" class="wp-block-jetpack-slideshow_button-pause" role="button"></a>
<div class="wp-block-jetpack-slideshow_pagination swiper-pagination swiper-pagination-white"></div>
</div>
</div>
<p><!-- /wp:jetpack/slideshow --></p>
<p><!-- wp:heading --></p>
<h2 class="wp-block-heading">Setting Up Windows Server</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Installing Windows Server</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Once the VM is set up correctly, the next step is to start the VM and install the operating system. (Make sure it is set up to boot the ISO before booting).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Once it has booted, select your preferences and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":179,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/1_WindowsSetup.png" alt="" class="wp-image-179"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Click <strong>Install now</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":180,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/2_InstallNow.png" alt="" class="wp-image-180"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Insert CD key if you have one. If not, you may get a free trial but it will expire after a set time.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>After that click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":181,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/3_CDKey.png" alt="" class="wp-image-181"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>You can choose to install with just a command-line environment or with a Desktop environment. I chose the latter (Desktop Experience).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":182,"width":"606px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/4_DesktopExperience.png" alt="" class="wp-image-182" style="width:606px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Accept the license terms and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":184,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/5_AcceptTerms.png" alt="" class="wp-image-184"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Select the Custom Install option.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":185,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/6_CustomInstall.png" alt="" class="wp-image-185"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Select <strong>Drive 0</strong> and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":186,"width":"578px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/7_SelectDrive.png" alt="" class="wp-image-186" style="width:578px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The setup wizard will now start the install process. Once it completes it should reboot the virtual machine.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":187,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/8_WaitforInstall.png" alt="" class="wp-image-187"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After the VM reboots, it should prompt you to set up a password. After doing so, click <strong>Finish</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":188,"width":"710px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/9_Password.png" alt="" class="wp-image-188" style="width:710px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Windows Server should now be ready.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Configuring Windows Server</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>If you are running your server in a virtual machine, it's always helpful to install guest tools on it. Guest tools are software that allow your keyboard and mouse input to pass to the virtual machine. Which tools to install and how to install them depends on what hypervisor you are using. For example, VMware uses "VMware Tools". </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>For my lab, I am using "Spice Guest Tools".</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":191,"width":"563px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/10_InstallGuestTools.png" alt="" class="wp-image-191" style="width:563px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The next step is to rename the machine.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>To rename the machine, click the start menu and search <strong>About</strong>. Then click on <strong>About your PC</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Click on <strong>Rename this PC</strong>, and rename it to whatever you like.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Then click <strong>Restart Now</strong> for it to take effect immediately.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":194,"width":"696px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/11_rename.png" alt="" class="wp-image-194" style="width:696px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After renaming the machine, the next task is to give it a static IP address. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>We need to give it a static IP address because it is a server, and servers usually should always keep the same IP address for long periods of time. Therefore, DHCP should not be in use here.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<!-- wp:list-item --></p>
<li>Right click on the network icon in the task bar</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>Open Network &amp; Internet settings</strong>
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click the <strong>Ethernet</strong> tab, then click <strong>Change adapter options</strong>
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Right click the adapter you want to configure and click <strong>Properties</strong>
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Highlight the "TCP/IPv4" settings and click <strong>Properties</strong>
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select "Use the following IP address" and "Use the following DNS server addresses" settings</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter the required information then click <strong>OK</strong><!-- wp:list -->
<ul>
<!-- wp:list-item --></p>
<li>For DNS, set the preferred DNS to localhost (127.0.0.1) and the alternative DNS to a public DNS</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list -->
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>After that, restart the VM.</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":197,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/12_net_settings.png" alt="" class="wp-image-197"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After rebooting, we should be ready to finally install Active Directory.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Installing Active Directory</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>At last we finally get to install Active Directory. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>First, open the Server Manager if it is not already open. Click on the <strong>Manage</strong> tab, then click on <strong>Add Roles and Features</strong>. This should open up an install wizard for setting up server roles. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>At the "Before You Begin" page, click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":199,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/13_beforeyoubegin.png" alt="" class="wp-image-199"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>For the "Installation Type" page, select the "Role-based or feature-based installation". Then click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":200,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/14_installationtype.png" alt="" class="wp-image-200"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>On the "Server Selection" page, select your server (there should only be one) and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":201,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/15_serverselect.png" alt="" class="wp-image-201"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Now for the Server Roles. Select the "Active Directory Domain Services" role. A pop-up window should come up. Leave the required features as is and click <strong>Add Features</strong>. Then click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":202,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2024/06/16_select_roles-1024x642.png" alt="" class="wp-image-202"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>At the "Features" page, we don't need any more features, so just click <strong>Next</strong> again.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":203,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/17_features.png" alt="" class="wp-image-203"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The "AD DS" page will tell us that we will need to install the DNS role for Active Directory to work properly. We will do that later. Click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":204,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/18_adds.png" alt="" class="wp-image-204"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>At the "Confirmation" page, confirm your choices and click <strong>Install</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":206,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/19_confirmation.png" alt="" class="wp-image-206"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The wizard will now install AD DS to your server. Once it is successfully finished, click Close.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":207,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/20_results.png" alt="" class="wp-image-207"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>We are not done yet though. A notification should have appeared on your dashboard. Click the icon and then click "Promote this server to a domain controller". </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":209,"width":"674px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/21_promotetodc.png" alt="" class="wp-image-209" style="width:674px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>A new window should pop up.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Since we have not set up a domain before, our only option is to set up a new forest. Select the "Add a new forest" option. Then enter a root domain name of your choosing. After doing so, click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":210,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/22_deploymentconfig.png" alt="" class="wp-image-210"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>On the DC Options page, select the highest possible Forest and Domain function levels. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Make sure the "DNS server" box is checked. The other boxes are grayed because it is a new forest. It has to be the Global Catalog and it cannot be a "Read-only DC". </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Choose a password and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":211,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/23_DC_options.png" alt="" class="wp-image-211"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>On the "DNS Options" page, leave the box unchecked and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":212,"width":"780px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/24_dnsoptions.png" alt="" class="wp-image-212" style="width:780px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>For "Additional Options", choose a NetBIOS domain name or leave the generated on as is. Click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":213,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/25_add_options.png" alt="" class="wp-image-213"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>For "Paths", you can choose the drives and locations for the Database, Logs, and SYSVOL folders. You can also leave them as default and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":214,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/26_paths.png" alt="" class="wp-image-214"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Review the options and click <strong>Next</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":215,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/27_review_opt.png" alt="" class="wp-image-215"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>At the "Prerequisites Check" page, you should get an "All perquisite checks passed" notification. You may also get a few warnings. That's okay if they are not critical. You can click <strong>Install</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":216,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/28_prereq_check.png" alt="" class="wp-image-216"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Your Active Directory should now install and your machine should reboot. After reboot, you should have AD DS running along with DNS. You can confirm this by see that they are up on the dashboard.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":220,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/30_services_up.png" alt="" class="wp-image-220"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Installing Active Directory Certificate Services</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>ADCS allows us to create certificate authorities to manage certificates for some protocols and services. For example, it allows us to use a more secure version of LDAP called LDAPS.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The steps are almost the same as installing ADDS.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>Click the Manage tab again, then click <strong>Add Roles and Features</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Leave as default and click next on the first three pages until you get to "Server Roles".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select the "Active Directory Certificate Services Role".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>Add Features</strong>. And click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Leave "Features" page default and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>Next</strong> at the "AD CS" page.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>At the "Role Services" page, check the "Certificate Authority box and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Finally, click <strong>Install</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>When the installation is finished, click <strong>Close</strong> and then reboot.</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":221,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/31_adcs.png" alt="" class="wp-image-221"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Now we have to configure AD CS.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>Open the <strong>Notifications</strong> tab, find the new notification, and click "Configure Active Directory Certificate Services..."</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>On the "Credentials" page, just leave as default click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>For "Role Services", check "Certificate Authority" and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Set the Setup Type as "Enterprise CA".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Set the CA Type as "Root CA".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Create a new private key.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Leave the cryptography as default and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Leave CA Name as default and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Change validity period to however long you prefer, then click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Leave the Certificate Database location as default and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Confirm and then click <strong>Configure</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Finally click <strong>Close</strong> and reboot your server.</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":223,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/32_adcs_up.png" alt="" class="wp-image-223"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>AD CS should now be up and running.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2 class="wp-block-heading">Setting Up Windows 10</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Installing Windows</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Now it's time to set up our first workstation. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":225,"width":"719px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/1_setup_win10-1.png" alt="" class="wp-image-225" style="width:719px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After creating a Window 10 VM, boot it up and start the installation process.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>Select Language, Time/Date format, and Keyboard Layout.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>Install Now</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter a product key or click "I don't have a product key".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select your operating system.<!-- wp:list -->
<ul>
<!-- wp:list-item --></p>
<li>Note: Only Pro, Education, or Enterprise can connect to Active Directory.</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list -->
</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Accept License Terms.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select Custom Install &gt; Select Drive</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Wait for Install to Finish.</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":226,"width":"648px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/2_install.png" alt="" class="wp-image-226" style="width:648px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After installing, the machine should reboot and then start with one more setup wizard.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":228,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/3_setup2.png" alt="" class="wp-image-228"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>Select your region</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Setup Keyboard layouts</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Instead of signing in with Microsoft account, select "Domain Join instead".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter a name and password for a temporary user</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Fill out security questions</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select Privacy Settings</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Disable Cortana because it's dumb</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>After that, the setup should be complete. Now we only need to install guest tools to the VM and we are ready to connect to the Domain Controller.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Network Firewall Configuration</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:image {"id":230,"width":"723px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/ports.png" alt="" class="wp-image-230" style="width:723px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>A lot of times an organization's network isn't flat. It could be segmented with multiple subnets, VLANs, and secured with firewall rules. That is sort of how built my Homelab. I designed my network using VLANs to segment it and Pfsense to handle routing and filtering. You can read more about it in my first blog <a href="https://ihabeid.xyz/2024/05/12/designing-and-building-my-homelab/" data-type="link" data-id="https://ihabeid.xyz/2024/05/12/designing-and-building-my-homelab/">post</a>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Long story short, I have configured my virtual machines to be on different VLANs. My internal services, including Active Directory, are tagged with VLAN 10. User devices and workstations are tagged with VLAN 20. This also means that they have to be routed through Pfsense in order to connect to each other. Therefore, I need to enable port numbers associated with Active Directory services, so that my workstation doesn't get blocked from connecting to the DC. The diagram above lists some of the ports required for Active Directory to function.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>In Pfsense, I created an alias grouping all of the required port number together:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":232,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2024/06/pfsense-alias-1024x771.png" alt="" class="wp-image-232"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>After that, I created a firewall rule using that alias to allow AD DS traffic between the UserLAN and the AdminLAN.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":245,"width":"745px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/firewall_rule-1.png" alt="" class="wp-image-245" style="width:745px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Now that my workstation has access to the DC, it's ready to connect to the domain.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":234,"width":"636px","height":"auto","sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full is-resized"><img src="{{site.baseurl}}/assets/2024/06/connection_allowed.png" alt="" class="wp-image-234" style="width:636px;height:auto"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:heading {"level":3} --></p>
<h3 class="wp-block-heading">Connecting Windows 10 to Active Directory</h3>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>The first step for connecting a Windows workstation to AD is to configure it to use the Domain Controller as its DNS server.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>On the Windows 10 machine, open <strong>Network and Internet Settings</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click the <strong>Ethernet</strong> tab.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>Change adapter options</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Choose an adapter, right click, and select <strong>Properties</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select IPv4 properties.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Select the "Use the following DNS server addresses:" option.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter the Domain Controller's IP address as the preferred DNS.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter either a local DNS or public DNS server as the alternative DNS server.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click <strong>OK</strong>, close settings, and reboot.</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":235,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/4_dns_settings.png" alt="" class="wp-image-235"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The next step is to rename the PC and join it to the Domain.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list {"ordered":true} --></p>
<ol>
<!-- wp:list-item --></p>
<li>First, on the workstation, go into the start menu and search "About your PC" and enter the settings.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click "Rename this PC", enter the new name, and click <strong>Next</strong>. Then click <strong>Restart later</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Go to "Connect to work or school" in settings.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Click the "Connect" button. Then click "Join this device to a local Active Directory domain".</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter the domain name and click <strong>Next</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Enter the Administrator username and password. It will also ask if you want to add an account. You can just click <strong>Skip</strong>.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Now we can finally <strong>Restart</strong>.</li>
<p><!-- /wp:list-item -->
</ol>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Now if we check the "Active Directory Users and Computers" settings on the DC, we can see that the workstation is part of the domain.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":236,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{site.baseurl}}/assets/2024/06/7_WS_added.png" alt="" class="wp-image-236"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:heading --></p>
<h2 class="wp-block-heading">End of Part 1</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>So far, I've set up my virtual machines, installed Active Directory, configured my firewall, and connected Windows 10 to the domain. In part 2, I will delve deeper into Active Directory by adding users, more workstations, configuring Group Policy settings, and maybe try some Powershell Scripting. That's all for now.</p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
